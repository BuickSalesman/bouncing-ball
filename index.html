<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Overlay</title>
    <style>
      html,
      body,
      #matter-container {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: transparent;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="matter-container"></div>
    <script>
      const { Engine, Render, Runner, Bodies, Composite, Query, Events, Mouse, MouseConstraint } = require("matter-js");
      const { ipcRenderer } = require("electron");

      const engine = Engine.create();
      const container = document.getElementById("matter-container");

      const render = Render.create({
        element: container,
        engine: engine,
        options: {
          width: window.innerWidth,
          height: window.innerHeight,
          wireframes: false,
          background: "transparent",
        },
      });

      const mouse = Mouse.create(render.canvas);

      const mouseConstraint = MouseConstraint.create(engine, {
        mouse: mouse,
        constraint: {
          stiffness: 0.2,
        },
      });

      const boxA = Bodies.rectangle(400, 200, 80, 80, {
        render: {
          fillStyle: "blue",
          strokeStyle: "blue",
          lineWidth: 2,
        },
      });
      const boxB = Bodies.rectangle(450, 50, 80, 80, {
        render: {
          fillStyle: "red",
          strokeStyle: "red",
          lineWidth: 2,
        },
      });
      const ground = Bodies.rectangle(
        400,
        610,
        810,
        60,
        { isStatic: true },
        {
          render: {
            fillStyle: "black",
            strokeStyle: "black",
            lineWidth: 2,
          },
        }
      );

      Composite.add(engine.world, [boxA, boxB, ground]);
      Composite.add(engine.world, mouseConstraint);

      Render.run(render);

      const runner = Runner.create();
      Runner.run(runner, engine);

      render.canvas.addEventListener("mousemove", (event) => {
        const rect = render.canvas.getBoundingClientRect();
        const mouseX = event.screenX - rect.left;
        const mouseY = event.screenY - rect.top;

        const allBodies = Composite.allBodies(engine.world);
        const bodiesUnderMouse = Query.point(allBodies, { x: mouseX, y: mouseY });

        if (bodiesUnderMouse.length > 0) {
          ipcRenderer.send("body-under");
        }

        if (bodiesUnderMouse.length === 0) {
          ipcRenderer.send("no-bodies-found");
        }
      });
    </script>
  </body>
</html>
